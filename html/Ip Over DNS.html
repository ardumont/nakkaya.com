<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head profile="http://gmpg.org/xfn/11">

    <link rel="shortcut icon" href="/favicon.ico" />
    <link rel="stylesheet" type="text/css" href="/style.css"
	  title="Nurullah Akkaya" media="screen,projection" />

    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

    <meta name="keywords" content="" />
    <meta name="description" content="" />

    <title>Ip Over Dns</title>

  </head><body>
    <!-- wrap START -->
    <div id="wrap">

      <!-- container START -->
      <div id="container">

	<!-- header START -->
	<div id="header">
	  <div id="caption">
	    <h1 id="title"><a href="http://nakkaya.com/">Nurullah
		Akkaya's Home</a></h1>
	    <div id="tagline">useless homepage for hosting pointless projects.</div>

	  </div>

	  <!-- navigation START -->
	  <div id="navigation">
	    <ul id="menus">
	      <li class="current_page_item"><a class="home" title="Home" href="http://nakkaya.com/">Home</a></li>
	      <li class="page_item page-item-2"><a href="Contact.html" title="About">About</a></li>
	      <li><a class="lastmenu" href="javascript:void(0);"></a></li>

	    </ul>

	    <!-- searchbox START -->

	    <div id="searchbox">
	      <form action="http://www.google.com/cse" id="cse-search-box">
		<div class="content">

		  <input type="hidden" name="cx" value="011327289396503571951:gmikuqrq7lm" />
		  <input type="hidden" name="ie" value="UTF-8" />
		  <input class="textfield" name="q" size="24" value="" type="text">
		  <span class="switcher">Switcher</span>
		</div>
		
		</form>
		<script type="text/javascript" src="http://www.google.com/coop/cse/brand?form=cse-search-box&lang=en"></script>
	    </div>
	    <!-- searchbox END -->

	    <div class="fixed"></div>
	  </div>
	  <!-- navigation END -->

	  <div class="fixed"></div>
	</div>

	<!-- header END -->

	<!-- content START -->
	<div id="content">

	  <!-- main START -->
	  <div id="main">

	    <div class="post" id="post-1">
	      <h2>Ip Over Dns</h2>

	      <div class="content">
<p>Ip over DNS will encapsulate all IP traffic inside DNS requests,
allowing access to the internet behind captive portals( cafes, airports
and such ). Captive portals usually block all traffic but they allow DNS
requests to flow through as long as you can lookup host names, you can
create your self a channel.</p>

<p>For this to work you need a couple of things,</p>

<ul>
<li>A registered domain name ( suc as example.com )</li>
<li>DNS server (or a registerer that provides DNS service)</li>
<li>A machine on the outside that can run a fake DNS server.</li>
</ul>

<h2>Registerer Setup</h2>

<p class="first">Choose a subdomain for you domain, you need to create two DNS
records. One NS and one A.</p>

<h5>NS (Name Servers)</h5>

<ul>
<li>tunnel &lt;&mdash;&gt; ns-dtun.example.com</li>
</ul>


<h5>A (Host)</h5>

<ul>
<li>ns-dtun.example.com  &lt;&mdash;&gt;  67.222.1.241</li>
</ul>

<p>The idea here is that all requests to a certain subdomain will be
delegated to another nameserver which is running our fake DNS server.
For this you need to be able to become root the server in order to run a
fake DNS service.</p>



<h2>Perl Setup</h2>

<p class="first">You need Perl in order to use ozymandns and a couple of extra modules.</p>

<ul>
<li>Enter the CPAN shell:

<ul>
<li>perl -MCPAN -e shell</li>
</ul></li>

<li>To re-configure the environment:

<ul>
<li>conf init</li>
</ul></li>

<li>Upgrade CPAN:

<ul>
<li>perl -MCPAN -e 'install Bundle::CPAN'</li>
</ul></li>

<li>Install modules:

<ul>
<li>perl -MCPAN -e 'install MIME::Base32'</li>
<li>perl -MCPAN -e 'install Net::DNS'</li>
<li>perl -MCPAN -e 'install Digest::CRC'</li>
</ul></li>
</ul>



<h2>Server Setup</h2>

<ul>
<li>Download <a href="http://www.doxpara.com/ozymandns_src_0.1.tgz">ozymandns_src_0.1.tgz</a></li>
<li>Start the server:</li>
</ul>

<pre class="example">
   sudo ./nomde.pl -i 0.0.0.0 tunnel.example.com
</pre>

<p>Make sure your firewall allows port 53 in bound for TCP and UDP.
Perl script crashes frequently so wrap it in a script that will re-run
it in case of a crash.</p>

<h3>Loop on Crash</h3>

<pre class="example">
#!/bin/sh

while [ 1 ]; do
 ps -ef | grep -v grep | grep nomde
 if [ $? -eq 1 ]
  then
   ./nomde.pl -i 0.0.0.0 dtun.example.org
 else
  echo .eq 0 - daemon found - do nothing.
fi
done
</pre>

<p>Save this file as start.sh and run it inside gnu screen so that the
script will keep running after you log out from your machine.</p>



<h2>Client Setup</h2>

<p class="first">On the client side, install same Perl modules as the server in addition
to Perl you also need SSH. Using SSH's ProxyCommand, all comunication
will be sent using droute.pl through our DNS channel to our server.</p>

<pre class="example">
ssh -o ProxyCommand=&quot;./droute.pl sshdns.tunnel.example.com&quot; -N -D 9999 -C user@localhost -v
</pre>

<p>This command will create a SOCKS proxy between our client and the server
in order to use it you need software that is capable of comunicating
through SOCKS.(such as Firefox) You can use a plugin such as FoxyProxy
to switch proxy on the fly.</p>

<p>The connection is slow, but good enough for checking your email or
surfing.</p>

<h4>Legal Notice</h4>

<p class="first">Circumventing AP's access control's is probably considered to a crime
depending on where you live. So behave don't be a jerk.</p>



<h2>Further Reading</h2>

<ul>
<li><a href="http://www.doxpara.com/dns_tc/Black_Ops_DNS_TC_files/v3_document.htm">Dan Kaminsky - Black Ops of DNS</a></li>
<li><a href="http://dnstunnel.de/">http://dnstunnel.de/</a></li>
</ul>

<p>Back to <a href="index.html">Home</a></p>



		<p class="under">
		</p>
		<div class="fixed"></div>
	      </div>
	    </div>	    

	  </div>
	  <!-- main END -->

	  
	  <!-- sidebar START -->
	  <div id="sidebar">

	    <!-- sidebar north START -->
	    <div id="northsidebar" class="sidebar">


	      <!-- showcase -->
	      
	      <div class="widget">
		<h3>Projects</h3>
	      </div>

	      
	      <div class="widget">		
		<h5>Lisp</h5>
		<ul>
		  <li><a href="nmapMode.html">nmapMode</a></li>
		  <li><a href="dsniffMode.html">dsniffMode</a></li>
		  <li><a href="sudoEl.html">sudoEl</a></li>
		</ul>

		<br/>
		<h5>Java</h5>
		<ul>
		  <li><a href="Mocha.html">Mocha</a></li>
		  <li><a href="regexBuiler.html">regexBuilder</a></li>
		  <li><a href="StartUpItem API.html">StartUpItem API</a></li>
		</ul>

		<br/>
		<h5>C/C++</h5>
		<ul>
		  <li><a href="makeWay.html">makeWay</a></li>
		</ul>
	      </div>

	      <!-- Start of Flickr Badge -->
	      <br/>
	      <br/>
	      <center>
		<script type="text/javascript"
		src="http://www.flickr.com/badge_code_v2.gne?count=1&display=random&size=t&layout=v&source=user&user=77255876%40N00"></script>
		</center>
	      <!-- End of Flickr Badge -->

	      
	    </div>

	  </div>
	  <!-- sidebar END -->
	  <div class="fixed"></div>
	</div>
	<!-- content END -->

	<!-- footer START -->
	<div id="footer">
	  <a id="gotop" href="#" onclick="MGJS.goTop();return false;">Top</a>
	  
	  <div id="copyright">
	    Copyright &copy; 2009 Nurullah Akkaya
	  </div>

	  <div id="themeinfo">
	    Last updated on
	    Friday, September 18, 2009

	    - Powered By 
	    <a href="http://mwolson.org/projects/EmacsMuse.html">Muse</a> , 
	    Theme by <a href="http://wordpress.org/extend/themes/inove">mg12</a>.</div>

	</div>
	<!-- footer END -->

      </div>
      <!-- container END -->
    </div>
    <!-- wrap END -->

<script src="http://www.google-analytics.com/urchin.js" 
	type="text/javascript">
</script>
<script type="text/javascript">
_uacct = "UA-87333-8";
urchinTracker();
</script>
</body></html>
