<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head profile="http://gmpg.org/xfn/11">

    <link rel="shortcut icon" href="/favicon.ico" />
    <link rel="stylesheet" type="text/css" href="/style.css"
	  title="Nurullah Akkaya" media="screen,projection" />

    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

    <meta name="keywords" content="" />
    <meta name="description" content="" />

    <title>nmap.el</title>

  </head><body>
    <!-- wrap START -->
    <div id="wrap">

      <!-- container START -->
      <div id="container">

	<!-- header START -->
	<div id="header">
	  <div id="caption">
	    <h1 id="title"><a href="http://nakkaya.com/">Nurullah
		Akkaya's Home</a></h1>
	    <div id="tagline">useless homepage for hosting pointless projects.</div>

	  </div>

	  <!-- navigation START -->
	  <div id="navigation">
	    <ul id="menus">
	      <li class="current_page_item"><a class="home" title="Home" href="http://nakkaya.com/">Home</a></li>
	      <li class="page_item page-item-2"><a href="Contact.html" title="About">About</a></li>
	      <li><a class="lastmenu" href="javascript:void(0);"></a></li>

	    </ul>

	    <!-- searchbox START -->

	    <div id="searchbox">
	      <form action="http://www.google.com/cse" id="cse-search-box">
		<div class="content">

		  <input type="hidden" name="cx" value="011327289396503571951:gmikuqrq7lm" />
		  <input type="hidden" name="ie" value="UTF-8" />
		  <input class="textfield" name="q" size="24" value="" type="text">
		  <span class="switcher">Switcher</span>
		</div>
		
		</form>
		<script type="text/javascript" src="http://www.google.com/coop/cse/brand?form=cse-search-box&lang=en"></script>
	    </div>
	    <!-- searchbox END -->

	    <div class="fixed"></div>
	  </div>
	  <!-- navigation END -->

	  <div class="fixed"></div>
	</div>

	<!-- header END -->

	<!-- content START -->
	<div id="content">

	  <!-- main START -->
	  <div id="main">

	    <div class="post" id="post-1">
	      <h2>nmap.el</h2>

	      <div class="content">
<pre class="example">

;; This program is free software; you can redistribute it and/or modify it under
;; the terms of the GNU General Public License as published by the Free Software
;; Foundation; either version 2 of the License, or any later version.
;;
;; This program is distributed in the hope that it will be useful, but WITHOUT
;; ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS
;; FOR A PARTICULAR PURPOSE.  See the GNU General Public License for more
;; details.
;;
;; You should have received a copy of the GNU General Public License along with
;; this program; if not, write to the Free Software Foundation, Inc., 59 Temple
;; Place - Suite 330, Boston, MA 02111-1307, USA.

;; Author: Nurullah Akkaya (nurullah@nakkaya.com)
;; Location: http://nakkaya.com
;; Version: 1.0

(load-library &quot;sudo&quot;)

(defvar nmap-nmap-program &quot;/opt/local/bin/nmap&quot;
  &quot;nmap command&quot;)
(defvar nmap-ifconfig-program &quot;ifconfig&quot;
  &quot;ifconfig command&quot;)
(defvar nmap-network-interface &quot;en1&quot;
  &quot;network interface used by ifconfig&quot;)
(defvar nmap-output-buffer &quot;*nmap-process*&quot;
  &quot;The user's cached sudo password, or an empty string.&quot;)
(setq nmap-port-scan-options (list &quot;-n&quot; ))
(defvar nmap-detect-os nil
  &quot;Whether to os detection&quot;)
(defvar nmap-use-decoy nil 
  &quot;Whether to use decoys while scanning&quot; )
(defvar nmap-decoy-list &quot;&quot; 
  &quot;Decoy list random ip's created from the same ip block&quot;)
(defvar nmap-number-of-decoys 4 
  &quot;Number of decoys&quot;)
(defvar nmap-detect-service nil 
  &quot;Whether to do service/info detection&quot;)
(defvar nmap-use-timing nil)
(defvar nmap-time-template 5)
(defvar nmap-targets &quot;0.0.0.0&quot;)
;;(defvar nmap-online-targets &quot;&quot;)
(defvar nmap-process-stack 0 
  &quot;Number of running nmap processes&quot;)

(defvar nmap-mode-map nil)
(setq nmap-mode-map (make-keymap))
(define-key nmap-mode-map &quot;c&quot; 'nmap-mode-map-clear)
(define-key nmap-mode-map &quot;t&quot; 'nmap-mode-map-target)
(define-key nmap-mode-map &quot;h&quot; 'nmap-mode-map-scan-host)
(define-key nmap-mode-map &quot;s&quot; 'nmap-mode-map-scan-targets)
(define-key nmap-mode-map &quot;q&quot; 'nmap-mode-map-quit)

(defun nmap-mode-map-quit( arg )
(interactive &quot;p&quot;)
  (nmap-quit &quot;&quot;))

(defun nmap-mode-map-clear( arg )
(interactive &quot;p&quot;)
  (nmap-clear-buffer &quot;&quot;))

(defun nmap-mode-map-target( arg )
(interactive &quot;p&quot;)
  (nmap-set-targets &quot;&quot;))

(defun nmap-mode-map-scan-host( arg )
(interactive &quot;p&quot;)
  (nmap-host-discovery &quot;&quot;))

(defun nmap-mode-map-scan-targets( arg )
(interactive &quot;p&quot;)
  (nmap-app-fingerprint &quot;&quot;))

(defvar nmap-active-button '(:foreground &quot;steelblue&quot;) )
(defvar nmap-highligth-host-face '( :foreground &quot;blue&quot;) )
(defvar nmap-options-face '( :foreground &quot;deepskyblue3&quot;))
(defvar nmap-quit-face '( :foreground &quot;firebrick&quot; ))

(defun nmap-change-interface ( button )
  (setq nmap-network-interface (read-string &quot;Interface: &quot;))
  (with-current-buffer &quot;*nmap*&quot;
    (erase-buffer))
  (nmap-print-header))

(defun nmap-get-ip ()
(interactive)
	(with-temp-buffer
	  (setq ifconfig-command (concat nmap-ifconfig-program 
					 &quot; &quot;
					 nmap-network-interface))
	  (shell-command ifconfig-command 1 )

	  (if (search-forward &quot;inet&quot; nil t)
	      (if (re-search-forward 
		   &quot;[0-9]*\\.[0-9]*\\.[0-9]*\\.[0-9]*&quot; nil t)
		  (buffer-substring (match-beginning 0) (point) ) )
	    &quot;0.0.0.0&quot;   )))

(defun nmap-get-ip-block ()
  (interactive)
  (setq nmap-ip-block
	;;get ip block
	(with-temp-buffer
	  (insert (nmap-get-ip))
	  (beginning-of-buffer)
	  (re-search-forward &quot;[0-9]*\\.[0-9]*\\.[0-9]*\\.&quot;)
	  (buffer-substring (point-min) (point) ))))

(defun nmap-host-discovery ( button )
  (interactive)  
  (setq block (concat nmap-ip-block &quot;1-255&quot; ) )  
  (setq options (list &quot;-sP&quot; 
		      &quot;-PS21,22,23,25,80,135,139,445,1025,3389&quot;
		      &quot;-PU53,67,68,69,111,161,445,514&quot;
		      &quot;-PE&quot; &quot;-PP&quot; &quot;-PM&quot;
		      block
		      ))
  (if (not(string= nmap-decoy-list &quot;&quot;))
      (add-to-list 'options nmap-decoy-list ) )

  (if (not(string= nmap-use-timing &quot;&quot;))
      (progn
	(setq timing (concat &quot;-T&quot; (number-to-string nmap-time-template) ))
	(add-to-list 'options  timing ) ))
  (nmap-print-options options)  
  ;;run nmap
  (setq nmap-process-stack (+ nmap-process-stack 1 ))
  (set-process-sentinel 
   (sudo-start-process 
    &quot;nmap-process&quot;
    (cons nmap-nmap-program options) ) 'nmap-process-sentinel))

(defun nmap-app-fingerprint ( button )
  ;;grap burrent targets
  (if (not(string= nmap-targets &quot;0.0.0.0&quot;))
      (setq ip nmap-targets)
    (setq ip (buffer-substring-no-properties 
	      (button-start button ) (button-end button ))))
  ;; (if (string= ip &quot;Scan All Found Host&quot;)
  ;;     (setq ip nmap-online-targets ))

  (end-of-buffer)

  ;;reset options
  (setq options (list  ))
  ;;split host list
  (dolist (ips (split-string ip)) 
    (add-to-list 'options ips))

  (dolist (option nmap-port-scan-options)
    (add-to-list 'options option))
  (if nmap-detect-service
      (add-to-list 'options &quot;-sV&quot; ))
  (if (eq nmap-use-timing t)
      (progn
	(setq timing (concat &quot;-T&quot; (number-to-string nmap-time-template) ))
	(add-to-list 'options  timing ) ))
  (nmap-print-options options)
  ;;run nmap
  (setq nmap-process-stack (+ nmap-process-stack 1 ))
  (set-process-sentinel 
   (sudo-start-process 
    &quot;nmap-process&quot;
    (cons nmap-nmap-program options) ) 'nmap-process-sentinel) )

(defun nmap-set-timing ( button )
 (setq nmap-time-template (string-to-number (read-string &quot;T: &quot;)))  
  (nmap-clear-buffer button))

(defun nmap-set-number-decoy ( button )
  (setq nmap-number-of-decoys 
	(string-to-number (read-string &quot;Number of decoys: &quot;)))  
  (nmap-clear-buffer button))

(defun nmap-toggle-os-detection ( button )
  (setq option &quot;-O&quot;)
  (if nmap-detect-os      
    (progn
      (setq nmap-port-scan-options 
	    (delete  option nmap-port-scan-options ))
      (setq nmap-detect-os nil))
      (progn
	(add-to-list 'nmap-port-scan-options option)
	(setq nmap-detect-os t)))
  (nmap-clear-buffer button))

(defun nmap-toggle-use-decoys (button)
  (with-temp-buffer
    (insert &quot;-D&quot;)
    (setq counter 1)
    (insert (nmap-get-ip-block) (number-to-string (random 255) ))
    (while (&lt; counter nmap-number-of-decoys)
      (insert &quot;,&quot; )
      (insert (nmap-get-ip-block) (number-to-string (random 255) ))
      (incf counter))
    (setq nmap-decoy-list (buffer-string)))
  (if nmap-use-decoy
      (progn
	(setq nmap-decoy-list &quot;&quot;)
	(setq nmap-use-decoy nil))
    (setq nmap-use-decoy t))
  (nmap-clear-buffer button))

(defun nmap-toggle-use-timing (button)
(if nmap-use-timing
    (setq nmap-use-timing nil)
  (setq nmap-use-timing t))
(nmap-clear-buffer button))

(defun nmap-toggle-detect-service (button)
  (if nmap-detect-service
      (setq nmap-detect-service nil)
    (setq nmap-detect-service t))
  (nmap-clear-buffer button))

(defun nmap-set-targets (button)
  (setq nmap-targets (read-string &quot;Target(s):&quot;  ))
  (nmap-clear-buffer button))

(defun nmap-print-options ( print-options )
(with-current-buffer &quot;*nmap*&quot;
  (end-of-buffer)
  (insert &quot;\nScanning...\n&quot;)
  (insert &quot;options: &quot;)
  (dolist (option print-options)
    (setq beg (point))
    (insert option )
    (setq end (point))
    (insert &quot;\n\t &quot;)
    (put-text-property beg end 'face nmap-options-face ))
  (insert &quot;\n&quot;)))

(defun nmap-quit ( button )
  (if (get-buffer &quot;*nmap-process*&quot;)
      (kill-buffer &quot;*nmap-process*&quot;))
(if (get-buffer &quot;*nmap*&quot;)
      (kill-buffer &quot;*nmap*&quot;)))

(defun nmap-print-header()
  (switch-to-buffer &quot;*nmap*&quot;)
  (erase-buffer)

  (setq beg (point))
  (insert &quot;Quit&quot;)
  (setq end (point))
  (make-button beg end 'action 'nmap-quit 'follow-link t)
  (put-text-property beg end 'face nmap-quit-face )
  (insert &quot;    &quot;)
  (setq beg (point))
  (insert &quot;Clear&quot;)
  (setq end (point))
  (make-button beg end 'action 'nmap-clear-buffer 'follow-link t)
  (put-text-property beg end 'face nmap-active-button )
  (insert &quot;\n\nTarget(s):  &quot; )
  (setq beg (point))
  (insert nmap-targets )
  (setq end (point))
  (make-button beg end 'action 'nmap-set-targets 'follow-link t)
  (put-text-property beg end 'face nmap-active-button )
  (insert &quot;\nInterface:  &quot; )
  (setq beg (point))
  (insert nmap-network-interface )
  (setq end (point))
  (make-button beg end 'action 'nmap-change-interface 'follow-link t)
  (put-text-property beg end 'face nmap-active-button )
  (insert &quot;\nIp:         &quot; (nmap-get-ip) &quot;\nIp Block:   &quot; 
	  (nmap-get-ip-block) &quot;1-255&quot;)
  
  (insert &quot;\n\n&quot;)
  (setq beg (point))
  (insert &quot;OS Detection&quot;)
  (setq end (point))
  (insert &quot; [&quot;)
  (if nmap-detect-os
      (insert &quot;*&quot;)
    (insert &quot; &quot;))
  (insert &quot;]&quot;)  
  (make-button beg end 'action 'nmap-toggle-os-detection 'follow-link t)
  (put-text-property beg end 'face nmap-active-button )
  (insert &quot;            &quot;)
  (setq beg (point))
  (insert &quot;Service/Version Info&quot;)  
  (setq end (point))
  (insert &quot; [&quot;)
  (if nmap-detect-service
      (insert &quot;*&quot;)
    (insert &quot; &quot;))
  (insert &quot;]&quot;)
  (make-button beg end 'action 'nmap-toggle-detect-service 'follow-link t)
  (put-text-property beg end 'face nmap-active-button )
  (insert &quot;\n&quot;)
  (setq beg (point))
  (insert &quot;Use Decoys&quot;)
  (setq end (point))
  (make-button beg end 'action 'nmap-toggle-use-decoys 'follow-link t)
  (put-text-property beg end 'face nmap-active-button )
  (insert &quot;   [&quot;)
  (if nmap-use-decoy
      (insert &quot;*&quot;)
    (insert &quot; &quot;))
  (insert &quot;] &quot;)
  (setq beg (point))
  (insert &quot;[&quot; (number-to-string nmap-number-of-decoys) &quot;]&quot; )
  (setq end (point))
  (make-button beg end 'action 'nmap-set-number-decoy 'follow-link t)
  (put-text-property beg end 'face nmap-active-button )  
  (insert &quot;        &quot;)
  (setq beg (point))
  (insert &quot;Timing Template&quot;)
  (setq end (point))
  (make-button beg end 'action 'nmap-toggle-use-timing 'follow-link t)
  (put-text-property beg end 'face nmap-active-button )
  (insert &quot;      [&quot;)
  (if nmap-use-timing
      (insert &quot;*&quot;)
    (insert &quot; &quot;))
  (insert &quot;] &quot;)
  (setq beg (point))
  (insert&quot;[&quot; (number-to-string nmap-time-template) &quot;]&quot; )
  (setq end (point))
  (make-button beg end 'action 'nmap-set-timing 'follow-link t)
  (put-text-property beg end 'face nmap-active-button )  
  (insert &quot;\n\n&quot;)
  (setq beg (point))
  (insert &quot;Scan Target(s)&quot;)
  (setq end (point))
  (make-button beg end 'action 'nmap-app-fingerprint 'follow-link t)
  (put-text-property beg end 'face nmap-active-button )
  (insert &quot;              &quot;)
  (setq beg (point))
  (insert &quot;Host Discovery&quot; )
  (setq end (point))
  (make-button beg end 'action 'nmap-host-discovery 'follow-link t)
  (put-text-property beg end 'face nmap-active-button )
  (insert &quot;\n\n&quot;))

(defun nmap ()
  (interactive)
  (if (eq (get-buffer &quot;*nmap*&quot;) nil)
      (progn
	(nmap-print-header)
	(nmap-mode))
    (switch-to-buffer &quot;*nmap*&quot;)))

(defun nmap-process-sentinel (process status)
(setq nmap-process-stack (- nmap-process-stack 1 ))
  (with-current-buffer &quot;*nmap*&quot;
    (end-of-buffer)
    (setq port-scan (nmap-parse-port-scan))
    (if port-scan
	(insert port-scan &quot;\n&quot;))
    (setq host-scan (nmap-parse-host-list))
    (if host-scan
	(insert host-scan &quot;\n&quot;)))
  (nmap-host-list-highligth)
(if (= nmap-process-stack 0)
    (kill-buffer &quot;*nmap-process*&quot;))
)

(defun nmap-parse-port-scan()
  (interactive)
(with-current-buffer &quot;*nmap-process*&quot;
    (beginning-of-buffer)

    (if (re-search-forward &quot;Start.*&quot; nil t )
	(progn 
	  (setq output-begin (match-beginning 0) )
	  (end-of-buffer)
	  (setq output-end (point))
	  (setq result (buffer-substring output-begin output-end ) )
	  (delete-region output-begin output-end)
	  (concat result &quot;\n&quot;)
))))

(defun nmap-parse-host-list()
  (with-current-buffer &quot;*nmap-process*&quot;
    (beginning-of-buffer)
    (if (re-search-forward &quot;^Host &quot; nil t )
	(progn 
	  (setq beg (match-beginning 0) )
	  (if (re-search-forward &quot;Nmap &quot; nil t)
	      (progn
		(setq end (match-beginning 0) )
		(setq result (buffer-substring beg end ))
		(delete-region beg end )
		result))))))

(defun nmap-host-list-highligth ()
  (interactive)
  (with-current-buffer &quot;*nmap*&quot;
  (beginning-of-buffer)
;;  (setq found-host-list nil)
;;  (setq nmap-online-targets &quot;&quot;)

  (setq beg  (re-search-forward &quot;^Host &quot; nil t))
  (while (not (eq beg nil) )
    (if (re-search-forward &quot;[0-9]*\\.[0-9]*\\.[0-9]*\\.[0-9]*&quot; nil t)
	(progn
	  (setq end (match-end 0))
	  ;;mark we found host list
;;	  (setq found-host-list t)
	  ;; ;;add each host found to targets
	  ;; (setq nmap-online-targets 
	  ;; 	(concat nmap-online-targets &quot; &quot; (buffer-substring beg end ) ) )

	  (make-button beg end 'action 'nmap-app-fingerprint 'follow-link t)
	  (put-text-property beg end 
			     'face nmap-highligth-host-face )))
    (setq beg (re-search-forward &quot;Host &quot; nil t )))
  ;; (if (eq found-host-list t )
  ;;     (progn 
  ;; 	;;add found hosts button to the bottom
  ;; 	(end-of-buffer)
  ;; 	(setq beg (point))
  ;; 	(insert &quot;Scan All Found Host&quot;)
  ;; 	(setq end (point))
  ;; 	(make-button beg end 'action 'nmap-app-fingerprint 'follow-link t)
  ;; 	(put-text-property beg end 'face nmap-highligth-host-face )
  ;; 	(insert &quot;\n&quot;))
  ;;   )
)
  (end-of-buffer))

(defun nmap-clear-buffer ( button )
  (with-current-buffer &quot;*nmap*&quot;
    (erase-buffer)
    (nmap-print-header)))

(defun nmap-mode ()
  &quot;nmap controling mode.&quot;
  (set (make-local-variable 'truncate-lines) t)
  (setq major-mode 'nmap-mode
	mode-name &quot;nmap&quot;)
  (use-local-map nmap-mode-map))
(provide 'nmap)
</pre>

<p>Back to <a href="index.html">Home</a></p>

		<p class="under">
		</p>
		<div class="fixed"></div>
	      </div>
	    </div>	    

	  </div>
	  <!-- main END -->

	  
	  <!-- sidebar START -->
	  <div id="sidebar">

	    <!-- sidebar north START -->
	    <div id="northsidebar" class="sidebar">


	      <!-- showcase -->
	      
	      <div class="widget">
		<h3>Projects</h3>
	      </div>

	      
	      <div class="widget">		
		<h5>Lisp</h5>
		<ul>
		  <li><a href="nmapMode.html">nmapMode</a></li>
		  <li><a href="dsniffMode.html">dsniffMode</a></li>
		  <li><a href="sudoEl.html">sudoEl</a></li>
		</ul>

		<br/>
		<h5>Java</h5>
		<ul>
		  <li><a href="Mocha.html">Mocha</a></li>
		  <li><a href="regexBuiler.html">regexBuilder</a></li>
		  <li><a href="StartUpItem API.html">StartUpItem API</a></li>
		</ul>

		<br/>
		<h5>C/C++</h5>
		<ul>
		  <li><a href="makeWay.html">makeWay</a></li>
		</ul>
	      </div>

	      <!-- Start of Flickr Badge -->
	      <br/>
	      <br/>
	      <center>
		<script type="text/javascript"
		src="http://www.flickr.com/badge_code_v2.gne?count=1&display=random&size=t&layout=v&source=user&user=77255876%40N00"></script>
		</center>
	      <!-- End of Flickr Badge -->

	      
	    </div>

	  </div>
	  <!-- sidebar END -->
	  <div class="fixed"></div>
	</div>
	<!-- content END -->

	<!-- footer START -->
	<div id="footer">
	  <a id="gotop" href="#" onclick="MGJS.goTop();return false;">Top</a>
	  
	  <div id="copyright">
	    Copyright &copy; 2009 Nurullah Akkaya
	  </div>

	  <div id="themeinfo">
	    Last updated on
	    Friday, September 18, 2009

	    - Powered By 
	    <a href="http://mwolson.org/projects/EmacsMuse.html">Muse</a> , 
	    Theme by <a href="http://wordpress.org/extend/themes/inove">mg12</a>.</div>

	</div>
	<!-- footer END -->

      </div>
      <!-- container END -->
    </div>
    <!-- wrap END -->

<script src="http://www.google-analytics.com/urchin.js" 
	type="text/javascript">
</script>
<script type="text/javascript">
_uacct = "UA-87333-8";
urchinTracker();
</script>
</body></html>
